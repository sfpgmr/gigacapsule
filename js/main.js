'use strict';

function _interopRequireWildcard(obj) { if (obj && obj.__esModule) { return obj; } else { var newObj = {}; if (obj != null) { for (var key in obj) { if (Object.prototype.hasOwnProperty.call(obj, key)) newObj[key] = obj[key]; } } newObj['default'] = obj; return newObj; } }

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { 'default': obj }; }

var _app = require('app');

var _app2 = _interopRequireDefault(_app);

var _denodeify = require('./denodeify');

var _denodeify2 = _interopRequireDefault(_denodeify);

var _browserWindow = require('browser-window');

var _browserWindow2 = _interopRequireDefault(_browserWindow);

var _ipc = require('ipc');

var _ipc2 = _interopRequireDefault(_ipc);

var _fs = require('fs');

var fs = _interopRequireWildcard(_fs);

var _path = require('path');

var path = _interopRequireWildcard(_path);

var _makedir = require('./makedir');

var _makedir2 = _interopRequireDefault(_makedir);

var _child_process = require('child_process');

var _crashReporter = require('crash-reporter');

var _crashReporter2 = _interopRequireDefault(_crashReporter);

var _player = require('./player');

var _player2 = _interopRequireDefault(_player);

var access = (0, _denodeify2['default'])(fs.access);
var exec = (0, _denodeify2['default'])(_child_process.exec);
var playPromises = Promise.resolve(0);
var cachePromises = Promise.resolve(0);
var cacheRoot = path.join(_app2['default'].getPath('cache'), 'sfpgmr');
var cachePath = path.join(cacheRoot, 'gigacapsule');
var workPath = path.join(cachePath, 'work');
var gigaCapsule = '';
var player;

_ipc2['default'].setMaxListeners(0);
_crashReporter2['default'].start();

var mainWindow = null;

_app2['default'].on('window-all-closed', function () {
  if (process.platform != 'darwin') _app2['default'].quit();
});

_app2['default'].on('ready', function () {
  // Giga Capsule ディスクをチェックする
  // Windows のみ...
  exec('wmic logicaldisk get caption').then(function (stdout, stderr) {
    return new Promise(function (resolve, reject) {
      stdout.split(/\r\r\n/).forEach(function (d) {
        if (d.match(/\:/)) {
          var drive = d.trim();
          if (fs.existsSync(drive + '/YMOGIGA.EXE')) {
            resolve(drive);
          }
        }
      });
      reject('Giga Capsule Disk Not Found.');
    });
  }).then(function (drive) {
    // Giga Capsuleのドライブ判明
    gigaCapsule = path.join(drive, '/');
    console.log(gigaCapsule);
    // キャッシュディレクトリ作成
    return Promise.resolve();
  }).then((0, _makedir2['default'])(cacheRoot)).then((0, _makedir2['default'])(cachePath)).then((0, _makedir2['default'])(workPath)).then(function () {
    // プレイヤー
    player = new _player2['default'](gigaCapsule, cachePath, workPath);

    return new Promise(function (resolve, reject) {
      // ブラウザ(Chromium)の起動, 初期画面のロード
      mainWindow = new _browserWindow2['default']({
        'width': 1024,
        'height': 768,
        'use-content-size': true,
        'center': true,
        'auto-hide-menu-bar': true,
        'title': 'YMO Giga Capusle Viewer',
        'web-preferences': {
          'direct-write': true
        }
      });
      mainWindow.loadUrl('file://' + __dirname + '/../index.html');
      mainWindow.on('closed', function () {
        mainWindow = null;
      });
      mainWindow.webContents.on('did-finish-load', function () {
        resolve();
      });
    });
  })
  // コンテンツの再生
  .then(function () {
    ['/MOVIE/QT/TITLE.MOV', '/MOVIE/QT/START.MOV', '/SAMPLING/01LAFEMM/01_01.AIF', '/SAMPLING/01LAFEMM/01_02.AIF', '/SAMPLING/01LAFEMM/01_03.AIF', '/SAMPLING/01LAFEMM/01_04.AIF', '/SAMPLING/02MADPIE/02_01.AIF', '/SAMPLING/02MADPIE/02_02.AIF', '/SAMPLING/02MADPIE/02_03.AIF', '/SAMPLING/02MADPIE/02_04.AIF', '/SAMPLING/03FIRECR/03_01.AIF', '/SAMPLING/03FIRECR/03_02.AIF', '/SAMPLING/03FIRECR/03_03.AIF', '/SAMPLING/03FIRECR/03_04.AIF', '/SAMPLING/03FIRECR/03_05.AIF', '/SAMPLING/04TONGPO/04_01.AIF', '/SAMPLING/04TONGPO/04_02.AIF', '/SAMPLING/04TONGPO/04_03.AIF', '/SAMPLING/04TONGPO/04_04.AIF', '/SAMPLING/04TONGPO/04_05.AIF', '/SAMPLING/04TONGPO/04_06.AIF', '/SAMPLING/05SIMOON/05_01.AIF', '/SAMPLING/05SIMOON/05_02.AIF', '/SAMPLING/05SIMOON/05_03.AIF', '/SAMPLING/05SIMOON/05_04.AIF', '/SAMPLING/05SIMOON/05_05.AIF', '/SAMPLING/05SIMOON/05_06.AIF', '/SAMPLING/05SIMOON/05_07.AIF', '/SAMPLING/05SIMOON/05_08.AIF', '/SAMPLING/06COSMIC/06_01.AIF', '/SAMPLING/06COSMIC/06_02.AIF', '/SAMPLING/07RYDEEN/07_01.AIF', '/SAMPLING/07RYDEEN/07_02.AIF', '/SAMPLING/07RYDEEN/07_03.AIF', '/SAMPLING/07RYDEEN/07_04.AIF', '/SAMPLING/07RYDEEN/07_05.AIF', '/SAMPLING/08TECHNO/08_01.AIF', '/SAMPLING/08TECHNO/08_02.AIF', '/SAMPLING/08TECHNO/08_03.AIF', '/SAMPLING/08TECHNO/08_04.AIF', '/SAMPLING/09BEHIND/09_01.AIF', '/SAMPLING/09BEHIND/09_02.AIF', '/SAMPLING/09BEHIND/09_03.AIF', '/SAMPLING/10CASTAL/10_01.AIF', '/SAMPLING/10CASTAL/10_02.AIF', '/SAMPLING/11SOLID/11_01.AIF', '/SAMPLING/11SOLID/11_02.AIF', '/SAMPLING/11SOLID/11_03.AIF', '/SAMPLING/11SOLID/11_04.AIF', '/SAMPLING/11SOLID/11_05.AIF', '/SAMPLING/11SOLID/11_06.AIF', '/SAMPLING/11SOLID/11_07.AIF', '/SAMPLING/12INSOMN/12_01.AIF', '/SAMPLING/12INSOMN/12_02.AIF', '/SAMPLING/13DAYTRI/13_01.AIF', '/SAMPLING/13DAYTRI/13_02.AIF', '/SAMPLING/13DAYTRI/13_03.AIF', '/SAMPLING/13DAYTRI/13_04.AIF', '/SAMPLING/14ABSOLU/14_01.AIF', '/SAMPLING/14ABSOLU/14_02.AIF', '/SAMPLING/14ABSOLU/14_03.AIF', '/SAMPLING/15MULTI/15_01.AIF', '/SAMPLING/16NICEAG/16_01.AIF', '/SAMPLING/16NICEAG/16_02.AIF', '/SAMPLING/17CITIZE/17_01.AIF', '/SAMPLING/18JINGLE/18_01.AIF', '/SAMPLING/19PRURJA/19_01.AIF', '/SAMPLING/19PRURJA/19_02.AIF', '/SAMPLING/19PRURJA/19_03.AIF', '/SAMPLING/19PRURJA/19_04.AIF', '/SAMPLING/19PRURJA/19_05.AIF', '/SAMPLING/19PRURJA/19_06.AIF', '/SAMPLING/20GRADAT/20_01.AIF', '/SAMPLING/20GRADAT/20_02.AIF', '/SAMPLING/21NEWTAN/21_01.AIF', '/SAMPLING/21NEWTAN/21_02.AIF', '/SAMPLING/21NEWTAN/21_03.AIF', '/SAMPLING/21NEWTAN/21_04.AIF', '/SAMPLING/21NEWTAN/21_05.AIF', '/SAMPLING/21NEWTAN/21_06.AIF', '/SAMPLING/21NEWTAN/21_07.AIF', '/SAMPLING/21NEWTAN/21_08.AIF', '/SAMPLING/22STAIRS/22_01.AIF', '/SAMPLING/22STAIRS/22_02.AIF', '/SAMPLING/23SEOULM/23_01.AIF', '/SAMPLING/23SEOULM/23_02.AIF', '/SAMPLING/23SEOULM/23_03.AIF', '/SAMPLING/23SEOULM/23_04.AIF', '/SAMPLING/24LIGHTI/24_01.AIF', '/SAMPLING/24LIGHTI/24_02.AIF', '/SAMPLING/25PROLOG/25_01.AIF', '/SAMPLING/25PROLOG/25_02.AIF', '/SAMPLING/25PROLOG/25_03.AIF', '/SAMPLING/26KEY/26_01.AIF', '/SAMPLING/26KEY/26_02.AIF', '/SAMPLING/26KEY/26_03.AIF', '/SAMPLING/26KEY/26_04.AIF', '/SAMPLING/27LIMBO/27_01.AIF', '/SAMPLING/28THEMAD/28_01.AIF', '/SAMPLING/28THEMAD/28_02.AIF', '/SAMPLING/28THEMAD/28_03.AIF', '/SAMPLING/29PERSPE/29_01.AIF'].forEach(function (p) {
      console.log(p);
      player.play(mainWindow, p);
    });
    //player.playEnd();

    return player.playPromises;
  }).then(function () {
    console.log('play end?.');
    setTimeout(function wait() {
      console.log(player.count);
      if (player.count) {
        setTimeout(wait, 1000);
      } else {
        player.clear();
      }
    }, 500);
  })['catch'](function (e) {
    var dialog = require('dialog');
    dialog.showErrorBox('Error', e);
    if (process.platform != 'darwin') _app2['default'].quit();
    //    console.log(e);
  });
  //app.quit();
});
//# sourceMappingURL=data:application/json;base64,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QzlCLDhCQUE4QixFQUM5Qiw4QkFBOEIsRUFDOUIsOEJBQThCLEVBQzlCLDhCQUE4QixFQUM5Qiw4QkFBOEIsRUFDOUIsOEJBQThCLEVBQzlCLDhCQUE4QixFQUM5Qiw4QkFBOEIsRUFDOUIsOEJBQThCLEVBQzlCLDhCQUE4QixFQUM5Qiw4QkFBOEIsRUFDOUIsOEJBQThCLEVBQzlCLDhCQUE4QixFQUM5Qiw4QkFBOEIsRUFDOUIsOEJBQThCLEVBQzlCLDhCQUE4QixFQUM5Qiw4QkFBOEIsRUFDOUIsNkJBQTZCLEVBQzdCLDZCQUE2QixFQUM3Qiw2QkFBNkIsRUFDN0IsNkJBQTZCLEVBQzdCLDZCQUE2QixFQUM3Qiw2QkFBNkIsRUFDN0IsNkJBQTZCLEVBQzdCLDhCQUE4QixFQUM5Qiw4QkFBOEIsRUFDOUIsOEJBQThCLEVBQzlCLDhCQUE4QixFQUM5Qiw4QkFBOEIsRUFDOUIsOEJBQThCLEVBQzlCLDhCQUE4QixFQUM5Qiw4QkFBOEIsRUFDOUIsOEJBQThCLEVBQzlCLDZCQUE2QixFQUM3Qiw4QkFBOEIsRUFDOUIsOEJBQThCLEVBQzlCLDhCQUE4QixFQUM5Qiw4QkFBOEIsRUFDOUIsOEJBQThCLEVBQzlCLDhCQUE4QixFQUM5Qiw4QkFBOEIsRUFDOUIsOEJBQThCLEVBQzlCLDhCQUE4QixFQUM5Qiw4QkFBOEIsRUFDOUIsOEJBQThCLEVBQzlCLDhCQUE4QixFQUM5Qiw4QkFBOEIsRUFDOUIsOEJBQThCLEVBQzlCLDhCQUE4QixFQUM5Qiw4QkFBOEIsRUFDOUIsOEJBQThCLEVBQzlCLDhCQUE4QixFQUM5Qiw4QkFBOEIsRUFDOUIsOEJBQThCLEVBQzlCLDhCQUE4QixFQUM5Qiw4QkFBOEIsRUFDOUIsOEJBQThCLEVBQzlCLDhCQUE4QixFQUM5Qiw4QkFBOEIsRUFDOUIsOEJBQThCLEVBQzlCLDhCQUE4QixFQUM5Qiw4QkFBOEIsRUFDOUIsOEJBQThCLEVBQzlCLDhCQUE4QixFQUM5Qiw4QkFBOEIsRUFDOUIsMkJBQTJCLEVBQzNCLDJCQUEyQixFQUMzQiwyQkFBMkIsRUFDM0IsMkJBQTJCLEVBQzNCLDZCQUE2QixFQUM3Qiw4QkFBOEIsRUFDOUIsOEJBQThCLEVBQzlCLDhCQUE4QixFQUM5Qiw4QkFBOEIsQ0FDekIsQ0FBQyxPQUFPLENBQUMsVUFBQyxDQUFDLEVBQUs7QUFDZixhQUFPLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQyxDQUFDO0FBQ2YsWUFBTSxDQUFDLElBQUksQ0FBQyxVQUFVLEVBQUMsQ0FBQyxDQUFDLENBQUM7S0FDM0IsQ0FBQyxDQUFDOzs7QUFHSCxXQUFPLE1BQU0sQ0FBQyxZQUFZLENBQUM7R0FDNUIsQ0FBQyxDQUFDLElBQUksQ0FBQyxZQUFJO0FBQ1YsV0FBTyxDQUFDLEdBQUcsQ0FBQyxZQUFZLENBQUMsQ0FBQztBQUMxQixjQUFVLENBQUMsU0FBUyxJQUFJLEdBQUc7QUFDekIsYUFBTyxDQUFDLEdBQUcsQ0FBQyxNQUFNLENBQUMsS0FBSyxDQUFDLENBQUM7QUFDMUIsVUFBRyxNQUFNLENBQUMsS0FBSyxFQUFDO0FBQ2Qsa0JBQVUsQ0FBQyxJQUFJLEVBQUMsSUFBSSxDQUFDLENBQUM7T0FDdkIsTUFBTTtBQUNMLGNBQU0sQ0FBQyxLQUFLLEVBQUUsQ0FBQztPQUNoQjtLQUNGLEVBQUMsR0FBRyxDQUFDLENBQUM7R0FDUixDQUFDLFNBQ0ksQ0FBQyxVQUFDLENBQUMsRUFBRztBQUNWLFFBQUksTUFBTSxHQUFHLE9BQU8sQ0FBQyxRQUFRLENBQUMsQ0FBQztBQUMvQixVQUFNLENBQUMsWUFBWSxDQUFDLE9BQU8sRUFBQyxDQUFDLENBQUMsQ0FBQztBQUMvQixRQUFJLE9BQU8sQ0FBQyxRQUFRLElBQUksUUFBUSxFQUM5QixpQkFBSSxJQUFJLEVBQUUsQ0FBQzs7R0FFZCxDQUFDLENBQUM7O0NBRUosQ0FBQyxDQUFDIiwiZmlsZSI6Im1haW4uanMiLCJzb3VyY2VzQ29udGVudCI6WyIndXNlIHN0cmljdCc7XHJcblxyXG5pbXBvcnQgYXBwIGZyb20gJ2FwcCc7XHJcbmltcG9ydCBkZW5vZGVpZnkgZnJvbSAnLi9kZW5vZGVpZnknO1xyXG5pbXBvcnQgQnJvd3NlcldpbmRvdyBmcm9tICdicm93c2VyLXdpbmRvdyc7XHJcbmltcG9ydCBpcGMgZnJvbSAnaXBjJztcclxuaW1wb3J0ICogYXMgZnMgZnJvbSAnZnMnO1xyXG5pbXBvcnQgKiBhcyBwYXRoICBmcm9tICdwYXRoJztcclxuaW1wb3J0IG1ha2VkaXIgZnJvbSAnLi9tYWtlZGlyJztcclxuaW1wb3J0IHsgZXhlYyAgYXMgZXhlY18gfSBmcm9tICdjaGlsZF9wcm9jZXNzJztcclxuaW1wb3J0IGNyYXNoUmVwb3J0ZXIgIGZyb20gJ2NyYXNoLXJlcG9ydGVyJztcclxuaW1wb3J0IFBsYXllciBmcm9tICcuL3BsYXllcic7XHJcblxyXG52YXIgYWNjZXNzID0gZGVub2RlaWZ5KGZzLmFjY2Vzcyk7XHJcbnZhciBleGVjID0gZGVub2RlaWZ5KGV4ZWNfKTtcclxudmFyIHBsYXlQcm9taXNlcyA9IFByb21pc2UucmVzb2x2ZSgwKTtcclxudmFyIGNhY2hlUHJvbWlzZXMgPSBQcm9taXNlLnJlc29sdmUoMCk7XHJcbnZhciBjYWNoZVJvb3QgPSBwYXRoLmpvaW4oYXBwLmdldFBhdGgoJ2NhY2hlJyksJ3NmcGdtcicpO1xyXG52YXIgY2FjaGVQYXRoID0gcGF0aC5qb2luKGNhY2hlUm9vdCwnZ2lnYWNhcHN1bGUnKTtcclxudmFyIHdvcmtQYXRoID0gcGF0aC5qb2luKGNhY2hlUGF0aCwnd29yaycpO1xyXG52YXIgZ2lnYUNhcHN1bGUgPSAnJztcclxudmFyIHBsYXllcjtcclxuXHJcbmlwYy5zZXRNYXhMaXN0ZW5lcnMoMCk7XHJcbmNyYXNoUmVwb3J0ZXIuc3RhcnQoKTtcclxuXHJcbnZhciBtYWluV2luZG93ID0gbnVsbDtcclxuXHJcbmFwcC5vbignd2luZG93LWFsbC1jbG9zZWQnLCBmdW5jdGlvbigpIHtcclxuICBpZiAocHJvY2Vzcy5wbGF0Zm9ybSAhPSAnZGFyd2luJylcclxuICAgIGFwcC5xdWl0KCk7XHJcbn0pO1xyXG5cclxuXHJcbmFwcC5vbigncmVhZHknLCBmdW5jdGlvbigpIHtcclxuICAvLyBHaWdhIENhcHN1bGUg44OH44Kj44K544Kv44KS44OB44Kn44OD44Kv44GZ44KLXHJcbiAgLy8gV2luZG93cyDjga7jgb8uLi5cclxuICBleGVjKCd3bWljIGxvZ2ljYWxkaXNrIGdldCBjYXB0aW9uJylcclxuICAudGhlbigoc3Rkb3V0LHN0ZGVycikgPT4ge1xyXG4gICAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlLHJlamVjdCkgPT4ge1xyXG4gICAgICAgIHN0ZG91dC5zcGxpdCgvXFxyXFxyXFxuLykuZm9yRWFjaCgoZCk9PntcclxuICAgICAgICAgIGlmKGQubWF0Y2goL1xcOi8pKXtcclxuICAgICAgICAgICAgbGV0IGRyaXZlID0gZC50cmltKCk7XHJcbiAgICAgICAgICAgIGlmKGZzLmV4aXN0c1N5bmMoZHJpdmUgKyAnL1lNT0dJR0EuRVhFJykpe1xyXG4gICAgICAgICAgICAgIHJlc29sdmUoZHJpdmUpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcbiAgICAgICAgcmVqZWN0KCdHaWdhIENhcHN1bGUgRGlzayBOb3QgRm91bmQuJyk7XHJcbiAgICB9KTtcclxuICB9KVxyXG4gIC50aGVuKChkcml2ZSk9PntcclxuICAgIC8vIEdpZ2EgQ2Fwc3VsZeOBruODieODqeOCpOODluWIpOaYjlxyXG4gICAgZ2lnYUNhcHN1bGUgPSBwYXRoLmpvaW4oZHJpdmUsJy8nKTtcclxuICAgIGNvbnNvbGUubG9nKGdpZ2FDYXBzdWxlKTtcclxuICAgIC8vIOOCreODo+ODg+OCt+ODpeODh+OCo+ODrOOCr+ODiOODquS9nOaIkFxyXG4gICAgcmV0dXJuIFByb21pc2UucmVzb2x2ZSgpO1xyXG4gIH0pXHJcbiAgLnRoZW4obWFrZWRpcihjYWNoZVJvb3QpKVxyXG4gIC50aGVuKG1ha2VkaXIoY2FjaGVQYXRoKSlcclxuICAudGhlbihtYWtlZGlyKHdvcmtQYXRoKSlcclxuICAudGhlbigoKSA9PiB7XHJcbiAgICAvLyDjg5fjg6zjgqTjg6Tjg7xcclxuICAgIHBsYXllciA9IG5ldyBQbGF5ZXIoZ2lnYUNhcHN1bGUsY2FjaGVQYXRoLHdvcmtQYXRoKTtcclxuXHJcbiAgICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24ocmVzb2x2ZSxyZWplY3Qpe1xyXG4gICAgLy8g44OW44Op44Km44K2KENocm9taXVtKeOBrui1t+WLlSwg5Yid5pyf55S76Z2i44Gu44Ot44O844OJXHJcbiAgICAgIG1haW5XaW5kb3cgPSBuZXcgQnJvd3NlcldpbmRvdyhcclxuICAgICAgICB7XHJcbiAgICAgICAgICAnd2lkdGgnOiAxMDI0LFxyXG4gICAgICAgICAgJ2hlaWdodCc6IDc2OCxcclxuICAgICAgICAgICd1c2UtY29udGVudC1zaXplJzp0cnVlLFxyXG4gICAgICAgICAgJ2NlbnRlcic6dHJ1ZSxcclxuICAgICAgICAgICdhdXRvLWhpZGUtbWVudS1iYXInOiB0cnVlLFxyXG4gICAgICAgICAgJ3RpdGxlJzonWU1PIEdpZ2EgQ2FwdXNsZSBWaWV3ZXInLFxyXG4gICAgICAgICAgJ3dlYi1wcmVmZXJlbmNlcyc6e1xyXG4gICAgICAgICAgICAnZGlyZWN0LXdyaXRlJzogdHJ1ZVxyXG4gICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgKTtcclxuICAgICAgbWFpbldpbmRvdy5sb2FkVXJsKCdmaWxlOi8vJyArIF9fZGlybmFtZSArICcvLi4vaW5kZXguaHRtbCcpO1xyXG4gICAgICBtYWluV2luZG93Lm9uKCdjbG9zZWQnLCBmdW5jdGlvbigpIHtcclxuICAgICAgICBtYWluV2luZG93ID0gbnVsbDtcclxuICAgICAgfSk7XHJcbiAgICAgIG1haW5XaW5kb3cud2ViQ29udGVudHMub24oJ2RpZC1maW5pc2gtbG9hZCcsIGZ1bmN0aW9uKCkge1xyXG4gICAgICAgIHJlc29sdmUoKTtcclxuICAgICAgfSk7ICAgIFxyXG4gICAgfSk7XHJcbiAgfSlcclxuICAvLyDjgrPjg7Pjg4bjg7Pjg4Tjga7lho3nlJ9cclxuICAudGhlbigoKT0+e1xyXG4gICAgW1xyXG4gICAgICAnL01PVklFL1FUL1RJVExFLk1PVicsXHJcbiAgICAgICcvTU9WSUUvUVQvU1RBUlQuTU9WJyxcclxuJy9TQU1QTElORy8wMUxBRkVNTS8wMV8wMS5BSUYnLFxyXG4nL1NBTVBMSU5HLzAxTEFGRU1NLzAxXzAyLkFJRicsXHJcbicvU0FNUExJTkcvMDFMQUZFTU0vMDFfMDMuQUlGJyxcclxuJy9TQU1QTElORy8wMUxBRkVNTS8wMV8wNC5BSUYnLFxyXG4nL1NBTVBMSU5HLzAyTUFEUElFLzAyXzAxLkFJRicsXHJcbicvU0FNUExJTkcvMDJNQURQSUUvMDJfMDIuQUlGJyxcclxuJy9TQU1QTElORy8wMk1BRFBJRS8wMl8wMy5BSUYnLFxyXG4nL1NBTVBMSU5HLzAyTUFEUElFLzAyXzA0LkFJRicsXHJcbicvU0FNUExJTkcvMDNGSVJFQ1IvMDNfMDEuQUlGJyxcclxuJy9TQU1QTElORy8wM0ZJUkVDUi8wM18wMi5BSUYnLFxyXG4nL1NBTVBMSU5HLzAzRklSRUNSLzAzXzAzLkFJRicsXHJcbicvU0FNUExJTkcvMDNGSVJFQ1IvMDNfMDQuQUlGJyxcclxuJy9TQU1QTElORy8wM0ZJUkVDUi8wM18wNS5BSUYnLFxyXG4nL1NBTVBMSU5HLzA0VE9OR1BPLzA0XzAxLkFJRicsXHJcbicvU0FNUExJTkcvMDRUT05HUE8vMDRfMDIuQUlGJyxcclxuJy9TQU1QTElORy8wNFRPTkdQTy8wNF8wMy5BSUYnLFxyXG4nL1NBTVBMSU5HLzA0VE9OR1BPLzA0XzA0LkFJRicsXHJcbicvU0FNUExJTkcvMDRUT05HUE8vMDRfMDUuQUlGJyxcclxuJy9TQU1QTElORy8wNFRPTkdQTy8wNF8wNi5BSUYnLFxyXG4nL1NBTVBMSU5HLzA1U0lNT09OLzA1XzAxLkFJRicsXHJcbicvU0FNUExJTkcvMDVTSU1PT04vMDVfMDIuQUlGJyxcclxuJy9TQU1QTElORy8wNVNJTU9PTi8wNV8wMy5BSUYnLFxyXG4nL1NBTVBMSU5HLzA1U0lNT09OLzA1XzA0LkFJRicsXHJcbicvU0FNUExJTkcvMDVTSU1PT04vMDVfMDUuQUlGJyxcclxuJy9TQU1QTElORy8wNVNJTU9PTi8wNV8wNi5BSUYnLFxyXG4nL1NBTVBMSU5HLzA1U0lNT09OLzA1XzA3LkFJRicsXHJcbicvU0FNUExJTkcvMDVTSU1PT04vMDVfMDguQUlGJyxcclxuJy9TQU1QTElORy8wNkNPU01JQy8wNl8wMS5BSUYnLFxyXG4nL1NBTVBMSU5HLzA2Q09TTUlDLzA2XzAyLkFJRicsXHJcbicvU0FNUExJTkcvMDdSWURFRU4vMDdfMDEuQUlGJyxcclxuJy9TQU1QTElORy8wN1JZREVFTi8wN18wMi5BSUYnLFxyXG4nL1NBTVBMSU5HLzA3UllERUVOLzA3XzAzLkFJRicsXHJcbicvU0FNUExJTkcvMDdSWURFRU4vMDdfMDQuQUlGJyxcclxuJy9TQU1QTElORy8wN1JZREVFTi8wN18wNS5BSUYnLFxyXG4nL1NBTVBMSU5HLzA4VEVDSE5PLzA4XzAxLkFJRicsXHJcbicvU0FNUExJTkcvMDhURUNITk8vMDhfMDIuQUlGJyxcclxuJy9TQU1QTElORy8wOFRFQ0hOTy8wOF8wMy5BSUYnLFxyXG4nL1NBTVBMSU5HLzA4VEVDSE5PLzA4XzA0LkFJRicsXHJcbicvU0FNUExJTkcvMDlCRUhJTkQvMDlfMDEuQUlGJyxcclxuJy9TQU1QTElORy8wOUJFSElORC8wOV8wMi5BSUYnLFxyXG4nL1NBTVBMSU5HLzA5QkVISU5ELzA5XzAzLkFJRicsXHJcbicvU0FNUExJTkcvMTBDQVNUQUwvMTBfMDEuQUlGJyxcclxuJy9TQU1QTElORy8xMENBU1RBTC8xMF8wMi5BSUYnLFxyXG4nL1NBTVBMSU5HLzExU09MSUQvMTFfMDEuQUlGJyxcclxuJy9TQU1QTElORy8xMVNPTElELzExXzAyLkFJRicsXHJcbicvU0FNUExJTkcvMTFTT0xJRC8xMV8wMy5BSUYnLFxyXG4nL1NBTVBMSU5HLzExU09MSUQvMTFfMDQuQUlGJyxcclxuJy9TQU1QTElORy8xMVNPTElELzExXzA1LkFJRicsXHJcbicvU0FNUExJTkcvMTFTT0xJRC8xMV8wNi5BSUYnLFxyXG4nL1NBTVBMSU5HLzExU09MSUQvMTFfMDcuQUlGJyxcclxuJy9TQU1QTElORy8xMklOU09NTi8xMl8wMS5BSUYnLFxyXG4nL1NBTVBMSU5HLzEySU5TT01OLzEyXzAyLkFJRicsXHJcbicvU0FNUExJTkcvMTNEQVlUUkkvMTNfMDEuQUlGJyxcclxuJy9TQU1QTElORy8xM0RBWVRSSS8xM18wMi5BSUYnLFxyXG4nL1NBTVBMSU5HLzEzREFZVFJJLzEzXzAzLkFJRicsXHJcbicvU0FNUExJTkcvMTNEQVlUUkkvMTNfMDQuQUlGJyxcclxuJy9TQU1QTElORy8xNEFCU09MVS8xNF8wMS5BSUYnLFxyXG4nL1NBTVBMSU5HLzE0QUJTT0xVLzE0XzAyLkFJRicsXHJcbicvU0FNUExJTkcvMTRBQlNPTFUvMTRfMDMuQUlGJyxcclxuJy9TQU1QTElORy8xNU1VTFRJLzE1XzAxLkFJRicsXHJcbicvU0FNUExJTkcvMTZOSUNFQUcvMTZfMDEuQUlGJyxcclxuJy9TQU1QTElORy8xNk5JQ0VBRy8xNl8wMi5BSUYnLFxyXG4nL1NBTVBMSU5HLzE3Q0lUSVpFLzE3XzAxLkFJRicsXHJcbicvU0FNUExJTkcvMThKSU5HTEUvMThfMDEuQUlGJyxcclxuJy9TQU1QTElORy8xOVBSVVJKQS8xOV8wMS5BSUYnLFxyXG4nL1NBTVBMSU5HLzE5UFJVUkpBLzE5XzAyLkFJRicsXHJcbicvU0FNUExJTkcvMTlQUlVSSkEvMTlfMDMuQUlGJyxcclxuJy9TQU1QTElORy8xOVBSVVJKQS8xOV8wNC5BSUYnLFxyXG4nL1NBTVBMSU5HLzE5UFJVUkpBLzE5XzA1LkFJRicsXHJcbicvU0FNUExJTkcvMTlQUlVSSkEvMTlfMDYuQUlGJyxcclxuJy9TQU1QTElORy8yMEdSQURBVC8yMF8wMS5BSUYnLFxyXG4nL1NBTVBMSU5HLzIwR1JBREFULzIwXzAyLkFJRicsXHJcbicvU0FNUExJTkcvMjFORVdUQU4vMjFfMDEuQUlGJyxcclxuJy9TQU1QTElORy8yMU5FV1RBTi8yMV8wMi5BSUYnLFxyXG4nL1NBTVBMSU5HLzIxTkVXVEFOLzIxXzAzLkFJRicsXHJcbicvU0FNUExJTkcvMjFORVdUQU4vMjFfMDQuQUlGJyxcclxuJy9TQU1QTElORy8yMU5FV1RBTi8yMV8wNS5BSUYnLFxyXG4nL1NBTVBMSU5HLzIxTkVXVEFOLzIxXzA2LkFJRicsXHJcbicvU0FNUExJTkcvMjFORVdUQU4vMjFfMDcuQUlGJyxcclxuJy9TQU1QTElORy8yMU5FV1RBTi8yMV8wOC5BSUYnLFxyXG4nL1NBTVBMSU5HLzIyU1RBSVJTLzIyXzAxLkFJRicsXHJcbicvU0FNUExJTkcvMjJTVEFJUlMvMjJfMDIuQUlGJyxcclxuJy9TQU1QTElORy8yM1NFT1VMTS8yM18wMS5BSUYnLFxyXG4nL1NBTVBMSU5HLzIzU0VPVUxNLzIzXzAyLkFJRicsXHJcbicvU0FNUExJTkcvMjNTRU9VTE0vMjNfMDMuQUlGJyxcclxuJy9TQU1QTElORy8yM1NFT1VMTS8yM18wNC5BSUYnLFxyXG4nL1NBTVBMSU5HLzI0TElHSFRJLzI0XzAxLkFJRicsXHJcbicvU0FNUExJTkcvMjRMSUdIVEkvMjRfMDIuQUlGJyxcclxuJy9TQU1QTElORy8yNVBST0xPRy8yNV8wMS5BSUYnLFxyXG4nL1NBTVBMSU5HLzI1UFJPTE9HLzI1XzAyLkFJRicsXHJcbicvU0FNUExJTkcvMjVQUk9MT0cvMjVfMDMuQUlGJyxcclxuJy9TQU1QTElORy8yNktFWS8yNl8wMS5BSUYnLFxyXG4nL1NBTVBMSU5HLzI2S0VZLzI2XzAyLkFJRicsXHJcbicvU0FNUExJTkcvMjZLRVkvMjZfMDMuQUlGJyxcclxuJy9TQU1QTElORy8yNktFWS8yNl8wNC5BSUYnLFxyXG4nL1NBTVBMSU5HLzI3TElNQk8vMjdfMDEuQUlGJyxcclxuJy9TQU1QTElORy8yOFRIRU1BRC8yOF8wMS5BSUYnLFxyXG4nL1NBTVBMSU5HLzI4VEhFTUFELzI4XzAyLkFJRicsXHJcbicvU0FNUExJTkcvMjhUSEVNQUQvMjhfMDMuQUlGJyxcclxuJy9TQU1QTElORy8yOVBFUlNQRS8yOV8wMS5BSUYnXHJcbiAgICBdLmZvckVhY2goKHApID0+IHtcclxuICAgICAgY29uc29sZS5sb2cocCk7XHJcbiAgICAgIHBsYXllci5wbGF5KG1haW5XaW5kb3cscCk7XHJcbiAgICB9KTtcclxuICAgIC8vcGxheWVyLnBsYXlFbmQoKTtcclxuXHJcbiAgICByZXR1cm4gcGxheWVyLnBsYXlQcm9taXNlcztcclxuICB9KS50aGVuKCgpPT57XHJcbiAgICBjb25zb2xlLmxvZygncGxheSBlbmQ/LicpO1xyXG4gICAgc2V0VGltZW91dChmdW5jdGlvbiB3YWl0ICgpe1xyXG4gICAgICBjb25zb2xlLmxvZyhwbGF5ZXIuY291bnQpO1xyXG4gICAgICBpZihwbGF5ZXIuY291bnQpe1xyXG4gICAgICAgIHNldFRpbWVvdXQod2FpdCwxMDAwKTtcclxuICAgICAgfSBlbHNlIHtcclxuICAgICAgICBwbGF5ZXIuY2xlYXIoKTtcclxuICAgICAgfVxyXG4gICAgfSw1MDApO1xyXG4gIH0pXHJcbiAgLmNhdGNoKChlKT0+e1xyXG4gICAgdmFyIGRpYWxvZyA9IHJlcXVpcmUoJ2RpYWxvZycpO1xyXG4gICAgZGlhbG9nLnNob3dFcnJvckJveCgnRXJyb3InLGUpO1xyXG4gICAgaWYgKHByb2Nlc3MucGxhdGZvcm0gIT0gJ2RhcndpbicpXHJcbiAgICAgIGFwcC5xdWl0KCk7XHJcbi8vICAgIGNvbnNvbGUubG9nKGUpO1xyXG4gIH0pO1xyXG4gIC8vYXBwLnF1aXQoKTtcclxufSk7XHJcblxyXG5cclxuXHJcbiJdLCJzb3VyY2VSb290IjoiL3NvdXJjZS8ifQ==
